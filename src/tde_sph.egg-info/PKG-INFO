Metadata-Version: 2.4
Name: tde-sph
Version: 1.0.0
Summary: Relativistic SPH framework for stellar tidal disruption events around SMBHs
Author: TDE-SPH Dev Team
Keywords: astrophysics,SPH,general-relativity,tidal-disruption,black-holes,CUDA
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Science/Research
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Topic :: Scientific/Engineering :: Astronomy
Classifier: Topic :: Scientific/Engineering :: Physics
Requires-Python: >=3.11
Description-Content-Type: text/markdown
Requires-Dist: numpy>=1.24.0
Requires-Dist: scipy>=1.10.0
Requires-Dist: numba>=0.58.0
Requires-Dist: cupy-cuda12x>=12.0.0; platform_machine == "x86_64"
Requires-Dist: h5py>=3.8.0
Requires-Dist: plotly>=5.14.0
Requires-Dist: pydantic>=2.0.0
Requires-Dist: pydantic-settings>=2.0.0
Requires-Dist: pyyaml>=6.0
Requires-Dist: kaleido>=0.2.1
Provides-Extra: dev
Requires-Dist: pytest>=7.3.0; extra == "dev"
Requires-Dist: pytest-cov>=4.1.0; extra == "dev"
Requires-Dist: pytest-benchmark>=4.0.0; extra == "dev"
Requires-Dist: black>=23.3.0; extra == "dev"
Requires-Dist: ruff>=0.0.270; extra == "dev"
Requires-Dist: mypy>=1.3.0; extra == "dev"
Requires-Dist: ipython>=8.12.0; extra == "dev"
Requires-Dist: jupyter>=1.0.0; extra == "dev"
Provides-Extra: viz
Requires-Dist: matplotlib>=3.7.0; extra == "viz"
Requires-Dist: seaborn>=0.12.0; extra == "viz"
Provides-Extra: extras
Requires-Dist: pyarrow>=12.0.0; extra == "extras"
Requires-Dist: pandas>=2.0.0; extra == "extras"

# TDE-SPH: Relativistic SPH Framework for Tidal Disruption Events

![Python 3.12+](https://img.shields.io/badge/python-3.12+-blue.svg)
![License: MIT](https://img.shields.io/badge/license-MIT-blue.svg)

A modular Python/CUDA framework for simulating stellar tidal disruption events (TDEs) around supermassive black holes using smoothed particle hydrodynamics (SPH). Supports both **general relativistic** and **Newtonian** dynamics.

## Features

- 3D SPH hydrodynamics with adaptive smoothing lengths (cubic spline kernel; Monaghan viscosity)
- Newtonian gravity (softened direct summation) and GR-ready metrics (Schwarzschild, Kerr)
- Ideal-gas EOS (gamma = 5/3, 4/3, or custom) with leapfrog integration and CFL control
- Polytropic stellar models (Lane-Emden), HDF5 snapshot I/O with compression
- Interactive visualization (Plotly, web viewer) and modular architecture with pluggable physics components
- GPU hooks (CUDA/Numba) plus diagnostics and configuration loaders

## Installation

### Requirements

- Python 3.12+
- CUDA toolkit (optional, for GPU acceleration)
- 8+ GB RAM (64 GB recommended for large simulations)

### Install

```bash
git clone https://github.com/yourusername/Black-Hole.git
cd Black-Hole

# Preferred: uv (creates venv + installs locked deps)
uv sync

# Verify environment
uv run python --version
```

Fallback (pip):

```bash
pip install -e ".[dev]"
```

## Quick Start

### Run a Newtonian TDE simulation (CLI)

```bash
# Using uv (recommended)
uv run python scripts/run_simulation.py \
  --particles 5000 \
  --tend 2.0 \
  --bh-mass 1e6 \
  --periapsis 1.0

# Explore options
uv run python scripts/run_simulation.py --help
```

Output:
- Snapshots in `output/snapshot_NNNN.h5`
- Energy diagnostics in terminal
- Optional 3D visualization

### Run from a YAML config

```python
from tde_sph.config import load_config
from tde_sph.core import Simulation

# Load and validate YAML (see configs/*.yaml)
config = load_config("configs/newtonian_tde.yaml")

# Provide your own ParticleSystem + physics modules if desired
sim = Simulation(config=config)
sim.run()
```

### Visualization

```python
from tde_sph.io import read_snapshot
from tde_sph.visualization import quick_plot

data = read_snapshot("output/snapshot_0010.h5")
positions = data['particles']['positions']
density = data['particles']['density']

fig = quick_plot(positions, color_by=density, log_scale=True)
fig.write_html("tde_visualization.html")
```

## Configuration (YAML)

Example files: `configs/newtonian_tde.yaml`, `configs/schwarzschild_tde.yaml`, `configs/kerr_retrograde_tde.yaml`, `configs/autogen1.yaml`.

- `simulation`: `mode` (`Newtonian`/`GR`), `t_start`, `t_end`, `dt_initial`, `dt_min`, `dt_max`, `dt_change_limit`, `snapshot_interval`, `log_interval`, `output_dir`
- `black_hole`: `mass`, `spin`
- `metric` (GR): `type` (`schwarzschild`/`kerr`/`minkowski`), `coordinate_system`
- `star`: `mass`, `radius`, `polytropic_index`
- `orbit`: `pericentre`, `eccentricity`, `inclination`
- `particles`: `count`, `sph_kernel`
- `integration`: `timestep`, `t_end`, `output_interval`, `dt_min`, `use_hamiltonian_integrator`, `isco_radius_threshold`, `cfl_factor`, `cfl_factor_gr`, `orbital_timestep_factor`
- `sph`: `neighbour_search_method`, `smoothing_length_eta`, `artificial_viscosity_alpha`, `artificial_viscosity_beta`
- `physics`: `eos`, `self_gravity`, `viscosity`, `gravity`, `radiation`
- `precision`: `use_fp64_for_metric`
- `misc`: `energy_tolerance`, `random_seed`, `verbose`

Load and override at runtime:

```python
config = load_config("configs/newtonian_tde.yaml", mode="GR", bh_spin=0.5)
```

## Architecture

### Modular Design (GUD-001)

All physics modules implement abstract interfaces, enabling easy swapping:

```
tde_sph/
├── core/           # Simulation orchestrator, interfaces
├── sph/            # Particles, kernels, hydro forces
├── gravity/        # Newtonian, relativistic
├── metric/         # Schwarzschild, Kerr
├── eos/            # Ideal gas, radiation
├── radiation/      # Cooling, transport
├── integration/    # Leapfrog, Hamiltonian
├── ICs/            # Polytrope, MESA models
├── io/             # HDF5, diagnostics
└── visualization/  # Plotly 3D, animations
```

### Component-Based System (PAT-001)

`Simulation` orchestrates:
- `ParticleSystem` - Particle data management
- `GravitySolver` - Gravity (Newtonian/GR)
- `EOS` - Thermodynamics
- `TimeIntegrator` - Time evolution
- `Metric` (optional) - Spacetime geometry
- `RadiationModel` (optional) - Cooling/heating

## Physics

### Units

Dimensionless units (GUD-003):
- G = 1 (gravitational constant)
- c = 1 (speed of light, for GR)
- M_BH = 1 (black hole mass)

### SPH Implementation

Follows modern SPH best practices (Price 2012):

- Density: ρ_i = Σ_j m_j W(|r_i - r_j|, h_ij)
- Pressure gradient: a_i = -Σ_j m_j (P_i/ρ_i^2 + P_j/ρ_j^2) ∇W_ij
- Artificial viscosity: Π_ij = (-α c̄_ij μ̄_ij + β μ̄_ij^2) / ρ̄_ij
- Adaptive smoothing: h_i ∝ (m_i/ρ_i)^(1/3), η ≈ 1.2

### Equation of State

Ideal gas: P = (γ - 1) ρ u

- γ = 5/3: Monatomic ideal gas (solar-type stars)
- γ = 4/3: Radiation-dominated (massive stars, WDs)

### Time Integration

Leapfrog (kick-drift-kick):
- CFL condition: dt = C min(h / (c_s + |v|))
- Acceleration constraint: dt = C min(sqrt(h / |a|))
- Energy-conserving by construction

## Testing

```bash
uv run pytest
```

## Performance

Reference CPU timings (illustrative, vary by hardware):
- 10^3 particles: ~1 s/step
- 10^4 particles: ~10 s/step
- 10^5 particles: ~100 s/step

## Examples

See `examples/` directory:

- `demo_polytrope.py` - Generate and visualize stellar models
- `demo_sph_forces.py` - SPH hydrodynamics test
- `demo_io_visualization.py` - I/O and plotting
- `newtonian_tde.ipynb` - Complete TDE simulation (notebook)

## Documentation

- **CLAUDE.md** - Complete project specification
- **Module CLAUDE.md** files - Module-specific guidelines
- Code docstrings - API documentation
- `examples/` - Tutorials and demonstrations

## Physics References

### SPH & Hydrodynamics
- Price (2012), J. Comp. Phys. 231, 759 - SPH review
- Monaghan (1997, 2005) - Artificial viscosity
- Cullen & Dehnen (2010) - Improved viscosity switches

### Tidal Disruption Events
- Guillochon & Ramirez-Ruiz (2013), ApJ 767, 25
- Rosswog et al. (2009) - Newtonian TDE SPH

### General Relativity
- Tejeda et al. (2017), MNRAS 469, 4483 [arXiv:1701.00303]
- Liptai & Price (2019), MNRAS 485, 819 [arXiv:1901.08064]
- Liptai et al. (2019), MNRAS 487, 4790 [arXiv:1910.10154]

### Advanced Physics
- Bonnerot et al. (2023) - Stream self-crossing [arXiv:2303.16230]
- Nealon & Price (2025) - Adaptive particle refinement
- SPH-EXA [arXiv:2510.26663] - High-resolution TDEs

## Contributing

This is a research code under active development. Contributions from other agents welcome!

### Development Workflow

1. Follow modular architecture (one feature per module)
2. Implement abstract interfaces
3. Add unit tests
4. Document with docstrings
5. Use type hints (numpy typing)
6. FP32 precision for GPU compatibility

### Code Style

- Black formatter (line length 100)
- Type hints with numpy.typing
- Comprehensive docstrings with references
- Physics equations in docstrings

## License

MIT License - see LICENSE file

## Citation

If you use this code, please cite:

```bibtex
@software{tde_sph_2025,
  title = {TDE-SPH: Relativistic SPH Framework for Tidal Disruption Events},
  author = {TDE-SPH AI Dev Team},
  year = {2025},
  url = {https://github.com/yourusername/Black-Hole}
}
```

## Contact

Issues: https://github.com/yourusername/Black-Hole/issues
